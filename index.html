<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>BSIS Offline Exam — BPM Lifecycle</title>
<style>
  :root{--bg:#f6f8fb;--card:#ffffff;--accent:#1f6feb;--danger:#b00020;--muted:#6b7280}
  *{box-sizing:border-box}body{font-family:Inter,Segoe UI,Roboto,Arial,sans-serif;margin:0;background:var(--bg);color:#0f172a}
  header{background:var(--card);padding:16px;display:flex;align-items:center;gap:12px;box-shadow:0 1px 6px rgba(2,6,23,.06);position:sticky;top:0;z-index:10}
  header h1{font-size:1.05rem;margin:0}header p{margin:0;color:var(--muted);font-size:.9rem}
  main{max-width:900px;margin:20px auto;padding:12px}
  .card{background:var(--card);padding:16px;border-radius:12px;box-shadow:0 8px 20px rgba(2,6,23,.04);margin-bottom:12px}
  label{display:block;margin-bottom:6px;font-weight:600}
  input[type=text], textarea, select{width:100%;padding:10px;border-radius:8px;border:1px solid #e6eef8;font-size:1rem}
  textarea{min-height:80px;resize:vertical}
  .row{display:flex;gap:8px}
  .muted{color:var(--muted);font-size:.95rem}
  .timer{margin-left:auto;padding:8px 12px;border-radius:999px;background:#fff0f0;color:var(--danger);font-weight:700}
  button{background:var(--accent);color:#fff;padding:10px 14px;border-radius:10px;border:0;font-weight:700}
  button.secondary{background:#eef2ff;color:var(--accent);font-weight:600}
  .hidden{display:none!important}
  .warn{background:#fff7ed;border-left:4px solid #ffd8a8;padding:10px;border-radius:8px}
  pre{background:#0b1220;color:#e6eef8;padding:12px;border-radius:8px;overflow:auto}
  .score-bubble{display:inline-block;padding:6px 10px;border-radius:999px;background:#ecfdf5;color:#065f46;font-weight:700}
</style>
</head>
<body>
<header>
  <div>
    <h1>BSIS Offline Exam — BPM Lifecycle</h1>
    <p class="muted">Based on: BPM Lifecycle Mini-Research Report</p>
  </div>
  <div class="timer" id="timer">35:00</div>
</header>

<main>
<section class="card warn">
  <strong>Important:</strong> Do not minimize or switch apps. If you leave, the exam resets to Question 1. Timer continues.
</section>

<form id="examForm" class="card" autocomplete="off">
  <input type="hidden" id="startedAt" name="startedAt" />
  <label>Student Name (required)</label>
  <input type="text" name="studentName" id="studentName" required placeholder="First Last"/>

  <hr style="margin:12px 0">

  <label>1. Design & Modeling – Describe the current process steps for your chosen real-life process. (4 pts)</label>
  <textarea name="q1" id="q1" placeholder="List the steps clearly..." required></textarea>

  <label style="margin-top:12px">2. Execution – Describe how the process is carried out in reality. (4 pts)</label>
  <textarea name="q2" id="q2" placeholder="Explain how people perform each step..." required></textarea>

  <label style="margin-top:12px">3. Monitoring – Identify issues, bottlenecks, or observations in the process. (4 pts)</label>
  <textarea name="q3" id="q3" placeholder="What did you observe or monitor?" required></textarea>

  <label style="margin-top:12px">4. Optimization Suggestions – Propose improvements. (4 pts)</label>
  <textarea name="q4" id="q4" placeholder="Give at least 2–3 suggestions" required></textarea>

  <label style="margin-top:12px">5. Personal Insight – Which BPM phase is most critical and why? (4 pts)</label>
  <textarea name="q5" id="q5" placeholder="Share your insight in 2–3 sentences..." required></textarea>

  <div style="margin-top:14px;display:flex;gap:8px;align-items:center">
    <button type="submit" id="submitBtn">Submit Exam</button>
    <button type="button" class="secondary" id="downloadBtn" disabled>Download Answers (.txt)</button>
    <div style="margin-left:auto" class="muted">Auto-scoring enabled</div>
  </div>
</form>

<section id="result" class="card hidden">
  <h3>✅ Exam Submitted</h3>
  <p class="muted">Show this screen to your instructor or download the answers file.</p>
  <p><strong>Student:</strong> <span id="resName"></span></p>
  <p><strong>Time left:</strong> <span id="resTime"></span></p>
  <p><strong>Auto-score:</strong> <span class="score-bubble" id="totalScore"></span> / 20</p>
  <p class="muted">Breakdown:</p>
  <ul id="breakdown"></ul>
  <pre id="savedAnswers"></pre>
</section>

<script>
// Config
const DURATION_MINUTES = 50;
let timerInterval = null;
let endTime = localStorage.getItem('bpmExamEnd') ? parseInt(localStorage.getItem('bpmExamEnd')) : Date.now() + DURATION_MINUTES*60*1000;
localStorage.setItem('bpmExamEnd', endTime);

// Elements
const timerEl = document.getElementById('timer');
const form = document.getElementById('examForm');
const result = document.getElementById('result');
const resName = document.getElementById('resName');
const resTime = document.getElementById('resTime');
const totalScoreEl = document.getElementById('totalScore');
const breakdownEl = document.getElementById('breakdown');
const savedAnswers = document.getElementById('savedAnswers');
const downloadBtn = document.getElementById('downloadBtn');

// Timer
function fmt(ms){
  const total = Math.max(0, Math.floor(ms/1000));
  const m = Math.floor(total/60);
  const s = total%60;
  return m + ':' + (s<10?'0'+s:s);
}

function updateTimer(){
  const remaining = endTime - Date.now();
  timerEl.textContent = fmt(remaining);
  if(remaining <=0){
    clearInterval(timerInterval);
    autoSubmit('Time is up. Auto-submitted.');
  }
}

timerInterval = setInterval(updateTimer, 300);
updateTimer();

// Anti-minimize reset
function resetToStart(){
  form.reset();
  window.scrollTo({top:0,behavior:'instant'});
  alert('You left the exam. The exam has been reset to Question 1. Timer continues.');
}
document.addEventListener('visibilitychange', ()=>{if(document.hidden) resetToStart();});

// Auto scoring (basic: just count text length)
function scoreText(text, maxPts){
  if(text.trim().length>50) return maxPts;
  if(text.trim().length>20) return Math.floor(maxPts/2);
  return 1;
}

// Submit
function autoScoreAndShow(data, reason){
  const q1=data.get('q1')||'',q2=data.get('q2')||'',q3=data.get('q3')||'',q4=data.get('q4')||'',q5=data.get('q5')||'';
  const name=data.get('studentName')||'Unknown';

  const s1=scoreText(q1,4),s2=scoreText(q2,4),s3=scoreText(q3,4),s4=scoreText(q4,4),s5=scoreText(q5,4);
  const total=s1+s2+s3+s4+s5;

  // Show results
  form.classList.add('hidden');
  result.classList.remove('hidden');
  resName.textContent=name;
  resTime.textContent=fmt(endTime-Date.now());
  totalScoreEl.textContent=total;
  breakdownEl.innerHTML='';
  [{k:'Design & Modeling',v:s1},{k:'Execution',v:s2},{k:'Monitoring',v:s3},{k:'Optimization',v:s4},{k:'Personal Insight',v:s5}]
    .forEach(it=>{
      const li=document.createElement('li');li.textContent=it.k+': '+it.v+'/4';breakdownEl.appendChild(li);
    });
  let out='== BPM Offline Exam Answers ==\nStudent: '+name+'\nSubmitted at: '+new Date().toLocaleString()+'\nReason: '+reason+'\n\n';
  out+='Q1: '+q1+'\nQ2: '+q2+'\nQ3: '+q3+'\nQ4: '+q4+'\nQ5: '+q5+'\nTOTAL: '+total+'/20\n';
  savedAnswers.textContent=out;
  downloadBtn.disabled=false;
  clearInterval(timerInterval);
  localStorage.setItem('bpmExamSubmitted','true');
  window.__examOutput=out;
}

// Auto submit
function autoSubmit(reason){
  const formData=new FormData(form);
  if(!formData.get('studentName')) formData.set('studentName','(no name)');
  autoScoreAndShow(formData, reason);
}

// Prevent access after submit
if(localStorage.getItem('bpmExamSubmitted')==='true'){
  form.classList.add('hidden');
  result.classList.remove('hidden');
  resName.textContent='Exam already submitted';
  resTime.textContent='0:00';
  totalScoreEl.textContent='0';
  breakdownEl.innerHTML='<li>Exam cannot be retaken.</li>';
}

// Event listeners
form.addEventListener('submit', e=>{e.preventDefault();autoSubmit('Submitted by user');});
downloadBtn.addEventListener('click', function(){
  const content=window.__examOutput||savedAnswers.textContent;
  const blob=new Blob([content],{type:'text/plain'});
  const a=document.createElement('a');a.href=URL.createObjectURL(blob);
  a.download=(document.getElementById('studentName').value||'student')+'_BPM_answers.txt';
  document.body.appendChild(a);a.click();a.remove();URL.revokeObjectURL(a.href);
});

// Disable copy/paste
function preventCopyPaste(e){e.preventDefault();}
[q1,q2,q3,q4,q5,document.getElementById('studentName')].forEach(el=>{
  el.addEventListener('paste',preventCopyPaste);
  el.addEventListener('copy',preventCopyPaste);
  el.addEventListener('cut',preventCopyPaste);
  el.addEventListener('contextmenu',preventCopyPaste);
  el.addEventListener('mousedown', e=>{if(e.detail>1) e.preventDefault();});
});

// Warn on close/refresh
window.addEventListener('beforeunload', e=>{e.preventDefault();e.returnValue='';});
</script>
</body>
</html>
